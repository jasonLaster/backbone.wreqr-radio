!function(a,b){if("function"==typeof define&&define.amd)define(["underscore","backbone","exports"],function(c,d,e){a.WreqrChannel=b(a,e,c,d)});else if("undefined"!=typeof exports){var c=require("underscore"),d=require("backbone");b(a,exports,c,d)}else a.Backbone.Wreqr=a._.extend(a.Backbone.Wreqr,b(a,{},a._,a.Backbone))}(this,function(a,b,c,d){"use strict";var e={};return e.Channel=function(a,b,c,e){if(a){var f=!1,g=d.Wreqr;b&&c&&e?b instanceof g.EventAggregator?c instanceof g.Commands?e instanceof g.RequestResponse||(f=!0):f=!0:f=!0:f=!0,f&&(b=new g.EventAggregator,e=new g.RequestResponse,c=new g.Commands),this.vent=b,this.reqres=e,this.commands=c,this.channelName=a}},c.extend(e.Channel.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(a){return this._connect("vent",a),this},connectCommands:function(a){return this._connect("commands",a),this},connectRequests:function(a){return this._connect("reqres",a),this},_connect:function(a,b){if(b){b=this._methodsFromHash(b);var d="vent"===a?"on":"setHandler";c.each(b,function(b,e){this[a][d](e,c.bind(b,this))},this)}},_methodsFromHash:function(a){var b,d={};return c.each(a,function(a,e){b=a,c.isFunction(b)||(b=this[b]),b&&(d[e]=b)},this),d}}),e.Station={attachChannel:function(a){return a&&a instanceof d.Wreqr.Channel?(this._channels=this._channels||[],c.contains(this._channels,a)||this._channels.push(a),a):void 0},detachChannel:function(a,b){if(this._channels&&a){var d=this.channel(a);if(d)return b===!0&&d.reset(),this._channels=c.without(this._channels,d),d}},detachAllChannels:function(a){if(this._channels){var b;c.each(this._channels,function(c){b=c.channelName,this.detachChannel(b,a)},this)}},channel:function(a){return this._channels?c.findWhere(this._channels,{channelName:a}):void 0},hasChannel:function(a){if(this._channels){var b=c.findWhere(this._channels,{channelName:a});return b?!0:!1}}},e});