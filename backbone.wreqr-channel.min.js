!function(a,b){if("function"==typeof define&&define.amd)define(["underscore","backbone","exports"],function(c,d,e){a.Backbone=b(a,e,c,d)});else if("undefined"!=typeof exports){var c=require("underscore"),d=require("backbone");b(a,exports,c,d)}else a.Backbone=a._.extend(a.Backbone,b(a,{},a._,a.Backbone))}(this,function(a,b,c,d){var e=d.Wreqr;return d.WreqrChannel={attachChannel:function(a,b,d,f){if(!c.isString(a)){var g=a;g.channelName&&(this._channels[g.channelName]=g)}return a=a||"local",b&&d&&f||(b=new e.EventAggregator,d=new e.Commands,f=f||new e.RequestResponse),this._channels=this._channels||{},this._channels[a]={channelName:a,vent:b,commands:d,reqres:f},this._channels[a]},resetChannel:function(a){a||c.each(this._channels,function(a){this.resetChannel(a.channelName)},this);var b=this.channel(a);b&&(b.vent.off(),b.reqres.removeAllHandlers(),b.commands.removeAllHandlers())},detachChannel:function(a,b){a||c.each(this._channels,function(a){this.detachChannel(a.channelName,b)},this);var d=this.channel(a);d&&(b&&this.resetChannel(a),delete this._channels[a])},channel:function(a){return this._channels[a]},connectEvents:function(a,b){return b=b||"local",a=this._methodsFromHash(a),c.each(a,function(a,d){this.channel(b).vent.on(d,c.bind(a,this))},this),this},connectCommands:function(a,b){return b=b||"local",a=this._methodsFromHash(a),c.each(a,function(a,d){this.channel(b).commands.setHandler(d,c.bind(a,this))},this),this},connectRequests:function(a,b){return b=b||"local",a=this._methodsFromHash(a),c.each(a,function(a,d){this.channel(b).reqres.setHandler(d,c.bind(a,this))},this),this},startChannel:function(a){var b=this.channel("channelName");if(b){{var d,e,f,g,h,i,a=b.channelName;b.vent,b.commands,b.reqres}if(this._defaultEvents&&this._defaultEvents[a]){var j=this._defaultEvents[a];d=j.vent,e=j.commands,f=j.requests}if(this.channelsHashes){var k=this.channelsHashes[a];g=k.vent,h=k.commands,i=k.requests}var l=c.extend({},d,g),m=c.extend({},e,h),n=c.extend({},f,i);this.connectEvents(l,a).connectCommands(m,a).connectRequests(n,a)}},_methodsFromHash:function(a){var b={};return c.each(a,function(a,d){method=a,c.isFunction(method)||(method=this[method]),method&&(b[d]=method)},this),b}},d.WreqrChannel});